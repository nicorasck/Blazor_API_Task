@inject GlobalService GlobalService
@* @inject ChildComponent ChildComponent *@

@* Nico Pico, DO NOT forget to pressent the list of Favorites 'ListOfFavorites'!!! 
Also testing a child component 'ChildComponent'
*@

<div class="home-page">

    <div class="history-card">
        @if (GlobalService.SavedNumbers != null && GlobalService.SavedNumbers.Any())
        {
            <h3 style="text-align: center; margin-top: 20px;">Number History</h3>
            @foreach (var number in GlobalService.SavedNumbers)
            {
                <div class="card text-center my-3">
                    <div class="card-header">
                        <h5 style="font-weight: bold;">Saved Number</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled">
                            <li><b>Valid:</b> @(number.valid ? "Yes" : "No")</li>
                            <li><b>Number:</b> @number.number</li>
                            <li><b>International Format:</b> @number.international_format</li>
                            <li><b>Country Prefix:</b> @number.country_prefix</li>
                            <li><b>Country Code:</b> @number.country_code</li>
                            <li><b>Country Name:</b> @number.country_name</li>
                            <li><b>Carrier:</b> @number.carrier</li>
                            <li><b>Line Type:</b> @number.line_type</li>
                        </ul>
                    </div>
                    <div class="card-footer text-muted">
                        Saved at: @DateTime.Now.ToString("f")
                        <div>
                            @if (GlobalService.IsFavorite(number))
                            {
                                <button class="btn btn-danger" type="button" @onclick="() => ToggleFavorite(number)">Remove Favorite</button>
                            }
                            else
                            {
                                <button class="btn btn-success" type="button" @onclick="() => ToggleFavorite(number)">Add as Favorite</button>
                            }
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div style="text-align: center; margin-top: 20px;">
                <h4>No saved searches yet.</h4>
                <p>Please validate and save a number to see it listed here.</p>
            </div>
        }
    </div>

<button class="btn btn-info" @onclick="ToggleFavoriteNumbers" style="margin: 20px;">Click here to Toggle favorite number</button>
@if(ShowFavoriteNumbers)
{
    foreach (var number in GlobalService.ListOfFavorites)
    {
        if(number.IsFavorite)
        {
            <CascadingValue Value="number">
                <ChildComponent OnFavoriteToggle="StateHasChanged"/>
            </CascadingValue>
        }

    }
}


</div>

@code {
    private void ToggleFavorite(NumberValidationData number)
    {
        // Bringing the functions from GlobalService via @injection
        if (GlobalService.IsFavorite(number))
        {
            GlobalService.RemoveFavoriteNumber(number);
        }
        else
        {
            GlobalService.AddFavoriteNumber(number);
        }
        StateHasChanged(); // Refreshing the website
    }
}

@code {
    private bool ShowFavoriteNumbers = false;

    // Toggle between showing favorite numbers or all saved numbers
    private void ToggleFavoriteNumbers()
    {
        ShowFavoriteNumbers = !ShowFavoriteNumbers;
    }

    // Get either all saved numbers or only the ones marked as favorite
    private List<NumberValidationData> FavoriteList()
    {
        return ShowFavoriteNumbers
            ? GlobalService.ListOfFavorites.ToList() // Only favorite numbers
            : GlobalService.SavedNumbers.ToList();   // Saved numbers
    }
}